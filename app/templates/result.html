{% extends "base.html" %}

{% block title %}üåü An√°lise Murphy-1 ULTRA - {{ data.star.name }}{% endblock %}

{% block content %}
<!-- ULTRA MURPHY-1 EXPERIENCE -->
<div class="ultra-murphy-experience">
    
    <!-- Hero Header com Gradiente C√≥smico -->
    <div class="cosmic-hero-header">
        <div class="stellar-particles"></div>
        <div class="hero-content">
            <h1 class="ultra-title">
                <span class="title-glow">AN√ÅLISE MURPHY-1</span>
                <span class="title-ultra">ULTRA</span>
            </h1>
            <div class="birth-signature">
                <p class="birth-moment">{{ data.cosmic_profile.birth_moment }}</p>
                <p class="cosmic-alignment">{{ data.cosmic_profile.cosmic_alignment }}</p>
                <p class="universal-signature">{{ data.cosmic_profile.universal_signature }}</p>
            </div>
            <div class="navigation-controls">
                <a href="/" class="nav-quantum-button">
                    <span>‚Üê NOVA AN√ÅLISE QU√ÇNTICA</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Visualizador Estelar -->
    <div class="stellar-projector-section">
        <div class="projector-frame">
            <h2 class="section-quantum-title">üåå PROJETOR ESTELAR MURPHY-1</h2>
            <p class="quantum-subtitle">Visualiza√ß√£o qu√¢ntica do espa√ßo-tempo no momento do seu nascimento</p>
            
            <div class="projector-container">
                <div class="holographic-frame">
                    <canvas id="modern-sky-canvas" class="quantum-canvas"></canvas>
                    
                    <!-- Painel Hologr√°fico de Informa√ß√µes -->
                    <div id="object-info-panel" class="holographic-panel hidden">
                        <div class="panel-header">
                            <h3 id="object-name">Objeto C√≥smico</h3>
                            <button id="close-panel" class="quantum-close">√ó</button>
                        </div>
                        <div class="panel-content">
                            <div id="object-details"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Se√ß√µes C√≥smicas Expans√≠veis -->
    <div class="cosmic-sections-container">
        
        <!-- Se√ß√£o 1: Informa√ß√µes da Estrela Zenital -->
        <div class="cosmic-section" data-section="star">
            <div class="section-header" onclick="toggleCosmicSection('star')">
                <div class="section-icon">‚≠ê</div>
                <h2 class="section-title">ESTRELA ZENITAL</h2>
                <div class="section-status">{{ data.star.name }}</div>
                <div class="expand-indicator">‚ñº</div>
            </div>
            <div class="section-content" id="section-star">
                <div class="star-identity">
                    <h3 class="star-name-ultra">{{ data.star.name }}</h3>
                    <p class="star-constellation">Constela√ß√£o: {{ data.star.constellation }}</p>
                    <div class="cosmic-message-frame">
                        <p class="cosmic-message">{{ data.cosmic_message }}</p>
                    </div>
                </div>
                
                <div class="stellar-data-grid">
                    <div class="data-quantum-module">
                        <h4>üìä CLASSIFICA√á√ÉO ESPECTRAL</h4>
                        <span class="data-ultra-value">{{ data.star.spectral_class }}</span>
                        <p class="data-description">Tipo estelar e temperatura</p>
                    </div>
                    
                    <div class="data-quantum-module">
                        <h4>‚ú® MAGNITUDE APARENTE</h4>
                        <span class="data-ultra-value">{{ data.star.magnitude }}</span>
                        <p class="data-description">Brilho observado da Terra</p>
                    </div>
                    
                    <div class="data-quantum-module">
                        <h4>üöÄ DIST√ÇNCIA C√ìSMICA</h4>
                        <span class="data-ultra-value">{{ data.star.distance_ly|int }} anos-luz</span>
                        <p class="data-description">Jornada da luz at√© voc√™</p>
                    </div>
                    
                    <div class="data-quantum-module">
                        <h4>üéØ COORDENADAS CELESTES</h4>
                        <span class="data-ultra-value">RA: {{ data.star.ra_degrees }}¬∞</span>
                        <span class="data-ultra-value">Dec: {{ data.star.dec_degrees }}¬∞</span>
                        <p class="data-description">Posi√ß√£o no cosmos</p>
                    </div>
                    
                    <div class="data-quantum-module">
                        <h4>üìç PROXIMIDADE ZENITAL</h4>
                        <span class="data-ultra-value">{{ data.star.distance_to_zenith }}¬∞</span>
                        <p class="data-description">Dist√¢ncia do z√™nite exato</p>
                    </div>
                    
                    <div class="data-quantum-module">
                        <h4>üåç SUAS COORDENADAS</h4>
                        <span class="data-ultra-value">{{ data.birth_info.coordinates }}</span>
                        <p class="data-description">Local do nascimento</p>
                    </div>
                </div>
                
                <!-- Curiosidades Estelares -->
                <div class="stellar-curiosities">
                    <h3>üî¨ ARQUIVO TEMPORAL DA ESTRELA</h3>
                    <div class="curiosities-timeline">
                        <div class="timeline-item">
                            <div class="timeline-icon">‚è∞</div>
                            <div class="timeline-content">
                                <h4>LINHA TEMPORAL C√ìSMICA</h4>
                                <p class="age-display">{{ data.star.curiosities.age_formatted }}</p>
                                <p class="temporal-message">{{ data.star.curiosities.temporal_message }}</p>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-icon">üìú</div>
                            <div class="timeline-content">
                                <h4>HIST√ìRIA ESTELAR</h4>
                                <p>{{ data.star.curiosities.history }}</p>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-icon">‚ö°</div>
                            <div class="timeline-content">
                                <h4>FATOS FASCINANTES</h4>
                                <ul class="quantum-facts-list">
                                    {% for fact in data.star.curiosities.fun_facts %}
                                    <li>{{ fact }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o 2: Fase da Lua -->
        <div class="cosmic-section" data-section="moon">
            <div class="section-header" onclick="toggleCosmicSection('moon')">
                <div class="section-icon">üåô</div>
                <h2 class="section-title">INFLU√äNCIA LUNAR</h2>
                <div class="section-status">{{ data.moon.phase_name }}</div>
                <div class="expand-indicator">‚ñº</div>
            </div>
            <div class="section-content" id="section-moon">
                <div class="moon-visualization">
                    <div class="moon-phase-display">
                        <div class="moon-disc" data-phase="{{ data.moon.phase }}">
                            <div class="moon-surface"></div>
                            <div class="moon-shadow"></div>
                        </div>
                        <div class="phase-info">
                            <h3>{{ data.moon.phase_name }}</h3>
                            <p class="phase-percentage">{{ data.moon.phase_percentage }}% iluminada</p>
                        </div>
                    </div>
                    
                    <div class="lunar-data-grid">
                        <div class="lunar-module">
                            <h4>üåô SIGNIFICADO M√çSTICO</h4>
                            <p>{{ data.moon.mystical_meaning }}</p>
                        </div>
                        
                        <div class="lunar-module">
                            <h4>üìè DIST√ÇNCIA DA TERRA</h4>
                            <span class="lunar-value">{{ data.moon.distance_km|default(0)|int }} km</span>
                        </div>
                        
                        <div class="lunar-module">
                            <h4>üìç POSI√á√ÉO NO C√âU</h4>
                            <span class="lunar-value">Alt: {{ data.moon.altitude }}¬∞ | Az: {{ data.moon.azimuth }}¬∞</span>
                        </div>
                        
                        <div class="lunar-module">
                            <h4>üåå CONSTELA√á√ÉO</h4>
                            <span class="lunar-value">{{ data.moon.constellation }}</span>
                        </div>
                    </div>
                    
                    <div class="lunar-prophecy">
                        <h4>üîÆ ENERGIA LUNAR</h4>
                        <p>{{ data.moon.phase_description }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o 3: Mar√©s C√≥smicas -->
        <div class="cosmic-section" data-section="tides">
            <div class="section-header" onclick="toggleCosmicSection('tides')">
                <div class="section-icon">üåä</div>
                <h2 class="section-title">MAR√âS GRAVITACIONAIS</h2>
                <div class="section-status">{{ data.tides.type }}</div>
                <div class="expand-indicator">‚ñº</div>
            </div>
            <div class="section-content" id="section-tides">
                <div class="tidal-visualization">
                    <div class="gravitational-forces">
                        <h3>üåå FOR√áAS C√ìSMICAS ATUANTES</h3>
                        <div class="force-bars">
                            <div class="force-bar">
                                <label>For√ßa Lunar:</label>
                                <div class="bar-container">
                                    <div class="bar-fill moon-force" style="width: {{ (data.tides.moon_force / 5 * 100)|round }}%"></div>
                                    <span class="force-value">{{ data.tides.moon_force }}</span>
                                </div>
                            </div>
                            <div class="force-bar">
                                <label>For√ßa Solar:</label>
                                <div class="bar-container">
                                    <div class="bar-fill sun-force" style="width: {{ (data.tides.sun_force / 5 * 100)|round }}%"></div>
                                    <span class="force-value">{{ data.tides.sun_force }}</span>
                                </div>
                            </div>
                            <div class="force-bar total">
                                <label>For√ßa Total:</label>
                                <div class="bar-container">
                                    <div class="bar-fill total-force" style="width: {{ (data.tides.total_force / 5 * 100)|round }}%"></div>
                                    <span class="force-value">{{ data.tides.total_force }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tidal-influence">
                        <h4>üß¨ INFLU√äNCIA PESSOAL</h4>
                        <p class="influence-description">{{ data.tides.personal_influence }}</p>
                        <div class="intensity-indicator">
                            <span class="intensity-label">Intensidade Gravitacional:</span>
                            <span class="intensity-value {{ data.tides.gravitational_intensity|lower }}">{{ data.tides.gravitational_intensity }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o 4: Perfil Astrol√≥gico -->
        <div class="cosmic-section" data-section="astrology">
            <div class="section-header" onclick="toggleCosmicSection('astrology')">
                <div class="section-icon">‚ôà</div>
                <h2 class="section-title">PERFIL C√ìSMICO</h2>
                <div class="section-status">{{ data.astrology.sun_sign }}</div>
                <div class="expand-indicator">‚ñº</div>
            </div>
            <div class="section-content" id="section-astrology">
                <div class="astrological-profile">
                    <div class="zodiac-identity">
                        <div class="sign-display">
                            <h3 class="zodiac-sign">{{ data.astrology.sun_sign }}</h3>
                            <p class="sign-description">{{ data.astrology.sun_description }}</p>
                        </div>
                        
                        <div class="elemental-composition">
                            <div class="element-badge {{ data.astrology.element|lower }}">
                                <span class="element-name">{{ data.astrology.element }}</span>
                                <span class="quality-name">{{ data.astrology.quality }}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="planetary-positions">
                        <h4>ü™ê POSI√á√ïES PLANET√ÅRIAS</h4>
                        <div class="planets-grid">
                            {% for planet, data_planet in data.astrology.planets.items() %}
                            <div class="planet-item {{ 'visible' if data_planet.visible else 'hidden' }}">
                                <span class="planet-name">{{ planet }}</span>
                                <span class="planet-constellation">{{ data_planet.constellation }}</span>
                                <span class="planet-visibility">{{ 'üëÅÔ∏è Vis√≠vel' if data_planet.visible else 'üåë Oculto' }}</span>
                            </div>
                            {% endfor %}
                        </div>
                        
                        <div class="dominant-planet">
                            <h5>üåü Planeta Dominante:</h5>
                            <span class="dominant-name">{{ data.astrology.dominant_planet }}</span>
                        </div>
                    </div>
                    
                    <div class="cosmic-summary">
                        <h4>‚ú® RESUMO C√ìSMICO</h4>
                        <p>{{ data.astrology.astrological_summary }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o 5: Eventos Estelares -->
        <div class="cosmic-section" data-section="events">
            <div class="section-header" onclick="toggleCosmicSection('events')">
                <div class="section-icon">üöÄ</div>
                <h2 class="section-title">EVENTOS C√ìSMICOS</h2>
                <div class="section-status">{{ data.stellar_events.historical_event.name if data.stellar_events.historical_event else 'Eventos √önicos' }}</div>
                <div class="expand-indicator">‚ñº</div>
            </div>
            <div class="section-content" id="section-events">
                <div class="stellar-events-timeline">
                    {% if data.stellar_events.historical_event %}
                    <div class="historical-event">
                        <h3>üèõÔ∏è EVENTO HIST√ìRICO PR√ìXIMO</h3>
                        <div class="event-card">
                            <div class="event-header">
                                <span class="event-icon">{{ data.stellar_events.historical_event.name.split()[0] }}</span>
                                <h4>{{ data.stellar_events.historical_event.name }}</h4>
                                <span class="event-date">{{ data.stellar_events.historical_event.date }}</span>
                            </div>
                            <p class="event-description">{{ data.stellar_events.historical_event.description }}</p>
                            {% if data.stellar_events.historical_event.cosmic_connection %}
                            <div class="cosmic-connection">
                                <h5>üåå CONEX√ÉO C√ìSMICA:</h5>
                                <p>{{ data.stellar_events.historical_event.cosmic_connection }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="seasonal-energy">
                        <h3>üå∏ ENERGIA SAZONAL</h3>
                        <div class="season-card">
                            <p>{{ data.stellar_events.seasonal_energy }}</p>
                        </div>
                    </div>
                    
                    <div class="birth-year-significance">
                        <h3>üìÖ SIGNIFICADO DO ANO</h3>
                        <p>{{ data.stellar_events.birth_year_significance }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- A√ß√µes Qu√¢nticas -->
    <div class="quantum-actions">
        <button onclick="generateUltimateReport()" class="quantum-button primary">
            <span>üî¨ GERAR RELAT√ìRIO ULTRA</span>
        </button>
        <button onclick="window.print()" class="quantum-button secondary">
            <span>üíæ SALVAR AN√ÅLISE</span>
        </button>
        <a href="/" class="quantum-button tertiary">
            <span>üîÑ NOVA AN√ÅLISE</span>
        </a>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="/static/js/modern-sky-viewer.js"></script>
<script type="application/json" id="sky-data">{{ result | tojson | safe }}</script>
<script>
// ===== ULTRA MURPHY-1 JAVASCRIPT EXPERIENCE =====

// Dados do c√©u para o visualizador
const skyData = JSON.parse(document.getElementById('sky-data').textContent);

// Verificar estrutura dos dados
console.log('üîç Sky Data:', skyData);

// Garantir estrutura correta para o visualizador
const visualizerData = {
    objects: skyData.objects || skyData.stars || [],
    constellation_lines: skyData.constellation_lines || [],
    constellation_name: skyData.constellation_name || 'N/A',
    zenith: {
        ra: skyData.zenith_ra || 0,
        dec: skyData.zenith_dec || 0
    }
};

console.log('‚ú® Total objects to render:', visualizerData.objects.length);

// Vari√°veis globais
let skyViewer = null;
let objectInfoPanel = null;

// ===== FUN√á√ÉO PARA ALTERNAR SE√á√ïES C√ìSMICAS =====
function toggleCosmicSection(sectionId) {
    const section = document.getElementById(`section-${sectionId}`);
    const header = document.querySelector(`[data-section="${sectionId}"] .section-header`);
    const indicator = header.querySelector('.expand-indicator');
    const cosmicSection = document.querySelector(`[data-section="${sectionId}"]`);
    
    if (section.style.maxHeight && section.style.maxHeight !== '0px') {
        // Fechar se√ß√£o
        section.style.maxHeight = '0px';
        indicator.style.transform = 'rotate(0deg)';
        cosmicSection.classList.remove('expanded');
        
        // Anima√ß√£o de colapso
        setTimeout(() => {
            section.style.opacity = '0';
        }, 100);
    } else {
        // Fechar todas as outras se√ß√µes primeiro
        document.querySelectorAll('.cosmic-section').forEach(otherSection => {
            if (otherSection !== cosmicSection) {
                const otherContent = otherSection.querySelector('.section-content');
                const otherIndicator = otherSection.querySelector('.expand-indicator');
                otherContent.style.maxHeight = '0px';
                otherIndicator.style.transform = 'rotate(0deg)';
                otherSection.classList.remove('expanded');
            }
        });
        
        // Abrir se√ß√£o selecionada
        section.style.opacity = '1';
        section.style.maxHeight = section.scrollHeight + 'px';
        indicator.style.transform = 'rotate(180deg)';
        cosmicSection.classList.add('expanded');
        
        // Scroll suave at√© a se√ß√£o
        cosmicSection.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start',
            inline: 'nearest'
        });
        
        // Efeitos especiais por se√ß√£o
        switch(sectionId) {
            case 'moon':
                animateMoonPhase();
                break;
            case 'tides':
                animateTidalForces();
                break;
            case 'astrology':
                animateZodiacSign();
                break;
            case 'events':
                animateTimeline();
                break;
        }
    }
}

// ===== ANIMA√á√ïES ESPECIAIS =====
function animateMoonPhase() {
    const moonDisc = document.querySelector('.moon-disc');
    if (moonDisc) {
        moonDisc.style.animation = 'moonPulse 2s ease-in-out';
        setTimeout(() => {
            moonDisc.style.animation = '';
        }, 2000);
    }
}

function animateTidalForces() {
    const forceBars = document.querySelectorAll('.bar-fill');
    forceBars.forEach((bar, index) => {
        setTimeout(() => {
            bar.style.animation = 'forceWave 1.5s ease-out';
            setTimeout(() => {
                bar.style.animation = '';
            }, 1500);
        }, index * 200);
    });
}

function animateZodiacSign() {
    const zodiacSign = document.querySelector('.zodiac-sign');
    if (zodiacSign) {
        zodiacSign.style.animation = 'zodiacGlow 3s ease-in-out';
        setTimeout(() => {
            zodiacSign.style.animation = '';
        }, 3000);
    }
}

function animateTimeline() {
    const eventCards = document.querySelectorAll('.event-card, .season-card');
    eventCards.forEach((card, index) => {
        setTimeout(() => {
            card.style.animation = 'cardReveal 0.8s ease-out';
            setTimeout(() => {
                card.style.animation = '';
            }, 800);
        }, index * 300);
    });
}

// ===== FUN√á√ÉO PARA GERAR RELAT√ìRIO ULTRA =====
function generateUltimateReport() {
    // Criar overlay de gera√ß√£o
    const overlay = document.createElement('div');
    overlay.className = 'generation-overlay';
    overlay.innerHTML = `
        <div class="generation-content">
            <div class="quantum-loader"></div>
            <h3>GERANDO RELAT√ìRIO ULTRA MURPHY-1</h3>
            <p>Compilando dados qu√¢nticos do cosmos...</p>
            <div class="progress-quantum">
                <div class="progress-fill"></div>
            </div>
        </div>
    `;
    
    document.body.appendChild(overlay);
    
    // Simular processo de gera√ß√£o
    setTimeout(() => {
        window.print();
        document.body.removeChild(overlay);
    }, 3000);
}

// ===== INICIALIZA√á√ÉO =====
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ ULTRA Murphy-1 initializing...');
    
    // Inicializar visualizador
    if (visualizerData.objects && visualizerData.objects.length > 0) {
        skyViewer = initializeModernSkyViewer('modern-sky-canvas', visualizerData);
        console.log('‚úÖ Sky viewer initialized');
    }
    
    // Configurar painel hologr√°fico
    setupHolographicPanel();
    
    // Inicializar efeitos de part√≠culas
    initStellarParticles();
    
    // Auto-abrir primeira se√ß√£o ap√≥s delay
    setTimeout(() => {
        toggleCosmicSection('star');
    }, 1000);
});

function setupHolographicPanel() {
    objectInfoPanel = document.getElementById('object-info-panel');
    const closeButton = document.getElementById('close-panel');
    
    if (closeButton) {
        closeButton.addEventListener('click', () => {
            objectInfoPanel.classList.add('hidden');
        });
    }
    
    // Escutar eventos de sele√ß√£o
    document.addEventListener('objectSelected', (event) => {
        const obj = event.detail;
        showHolographicInfo(obj);
    });
}

function showHolographicInfo(obj) {
    const nameElement = document.getElementById('object-name');
    const detailsElement = document.getElementById('object-details');
    
    if (nameElement) nameElement.textContent = obj.name;
    
    if (detailsElement) {
        detailsElement.innerHTML = `
            <div class="holographic-details">
                <div class="detail-quantum-item">
                    <span class="detail-label">Tipo:</span>
                    <span class="detail-value">${obj.type === 'star' ? 'Estrela' : 'Objeto Celeste'}</span>
                </div>
                <div class="detail-quantum-item">
                    <span class="detail-label">Magnitude:</span>
                    <span class="detail-value">${obj.magnitude ? obj.magnitude.toFixed(2) : 'N/A'}</span>
                </div>
                <div class="detail-quantum-item">
                    <span class="detail-label">Cor Espectral:</span>
                    <span class="detail-value" style="color: ${obj.color}">
                        <span class="quantum-color-dot" style="background: ${obj.color}"></span>
                        ${obj.color}
                    </span>
                </div>
            </div>
        `;
    }
    
    objectInfoPanel.classList.remove('hidden');
}

function initStellarParticles() {
    const particlesContainer = document.querySelector('.stellar-particles');
    if (!particlesContainer) return;
    
    for (let i = 0; i < 50; i++) {
        const particle = document.createElement('div');
        particle.className = 'stellar-particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 20 + 's';
        particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
        particlesContainer.appendChild(particle);
    }
}
</script>
{% endblock %}